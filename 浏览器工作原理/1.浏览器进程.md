## 浏览器进程

#### 单进程浏览器:浏览器的所有功能模块都运行在一个进程中

2007年之前，市面上浏览器都是单进程的

![单进程浏览器](C:\Users\Admin\Desktop\浏览器工作原理小册\image\单进程浏览器.png)

缺点:

- [ ] cchajiankeiuhajiankeiu不稳定:

  - 早期浏览器中使用了很多插件来实现诸如Web视频，Web游戏等功能，但插件容易出问题导致浏览器的崩溃。

  - 渲染引擎模块中的一些复杂js代码也可能引起崩溃

- [ ] 不流畅:

  - 由图可知，所有页面渲染、js执行环境及插件都运行在页面线程中，即同一时刻只能有一个模块执行。无线循环脚本及插件会造成浏览器变慢

    ```JavaScript
    function freeze() {
    //执行这个无限循环脚本，会独占整个线程，导致其他模块没办法执行，浏览器失去响应
    while (1) {
    console.log("freeze");
    }
    }
    freeze();
    ```

  - 页面存在内存泄漏：每次一个复杂页面关闭后，可能存在内存不完全回收问题，时间一长，内存占用高，浏览器会变慢。(因为页面关闭不是关闭进程，如果关闭进程，其中就算存在内存泄漏也能完全回收)

- [ ] 不安全

  - 插件使用c/c++等代码编写，**通过插件可以获取到操作系统的任意资源**，即插件可以任意操作你的电脑，引发安全性问题
  - 页面脚本可以通过浏览器漏洞获取系统权限引发安全问题

#### 多进程浏览器

##### 早期:

![多进程浏览器结构](C:\Users\Admin\Desktop\浏览器工作原理小册\image\多进程浏览器结构.png)

解决单进程浏览器问题:

- [ ] 不稳定:进程相互隔离，一个页面或插件崩溃，只影响当前页面或插件，不影响浏览器及其他页面
- [ ] 不流畅:每个页面都有自己的渲染进程，当js阻塞时，只会影响一个页面，不印象别的页面。当页面关闭，也就是对应的渲染进程关闭时，内存完全被系统回收，解决内存泄漏问题
- [ ] 不安全:Chrome把插件进程与渲染进程放在沙箱里，不能获取系统权限，解决安全问题(多进程架构的额外好处是可以使用安全沙箱，单进程为啥不行不知道)

##### 目前多进程架构:

![后期多进程浏览器架构](C:\Users\Admin\Desktop\浏览器工作原理小册\image\后期多进程浏览器架构.png)

一个Chrome浏览器包括：

- 一个浏览器主进程:主要**负责页面显示，用户交互，子进程管理，储存**
- 一个GPU进程:最初实现3D CSS效果，现在用来**绘制网页/UI界面** 
- 一个网络进程:负责页面的网络资源的加载
- 多个渲染进程：将HTML\CSS\JavaScript**转化成用户能交互的网页**。默认每个页面都有一个渲染进程，运行在沙箱模式下
- 多个插件进程:负责插件的运行

缺点:

- [ ] 更高的资源占用:每个进程都含有公共基础结构副本(如js运行环境等)，消耗资源
- [ ] 更复杂的体系结构:浏览器各模块耦合性高，扩展差

##### 未来的面向服务架构

各种模块会被重构成独立的服务，每个服务都可以在独立的进程中运行，访问服务需要使用定义好的接口，通过IPC通信，构建**⼀个更内聚、松耦合、易于维护和扩展的系统**

![未来的多进程浏览器结构](C:\Users\Admin\Desktop\浏览器工作原理小册\image\未来的多进程浏览器结构.png)

提供灵活的弹性架构，在强⼤性能设备上会以多进程的⽅式运⾏基础服务，但是如果在资源 受限的设备上，Chrome会将很多服务整合到⼀个进程中，从⽽节省内存占⽤。