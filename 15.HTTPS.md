## HTTPS

##### HTTP是不安全的，当通信具备**机密性，完整性，身份认证和不可否认**四个特性则可认为安全。

- [ ] 机密性:对数据的保密
- [ ] 完整性:数据在传输过程没被篡改，始终保持一致
- [ ] 身份认证:确认对方的真实身份
- [ ] 不可否认:对于已经发生的行为，不能否认

HTTPS符合安全特性的协议，默认端口号为443

##### HTTPS是"HTTP over SSL/TLS",让HTTP运行在了安全的SSL/TLS上

##### SSL：安全套接层，处于OSI的第五层(会话层)，发展到v3版本时改名为TLS

现在用的最广泛的是**TLS** 1.2

密码套件一般是"密钥交换算法+签名算法+对称加密算法+摘要算法"，OpenSSL 是著名的开源密码学工具包，是 SSL/TLS 的具体实现。

特性的实现:

- **机密性:加密**

  加密前的消息叫"明文"，加密后叫"密文"，钥匙叫"密钥"(保密的)，用密钥还原明文叫"解密"，加密解密的操作过程是"加密算法"(公开的)

  密钥的度量单位是位(1位=8bytes)

  加密分为:

  - [ ] 对称加密:加密和解密都使用一个密钥，保证了密钥安全，通信过程就保证了机密性，常用 AES 和 ChaCha20。

    对称加密的分组模式:可以让算法用固定长度的密钥加密任意长度的明文，把小秘密(密钥)转化为大秘密(密文)

    缺点：在传输过程中可能被窃取密钥，不能保证机密性

  - [ ] 非对称加密:有两个密钥，一个公钥，一个私钥   (DH、DSA、RSA、ECC)

    公钥公开给多诱人使用，私钥 严格保密，具有单向性,公钥加密只能用私钥解密，私钥加密只能用公钥解密

    网站秘密保管私钥，在网上任意发放公钥

    缺点：运算速度很慢

  - [ ] 混合加密:在通信开始时使用非对称算法，解决密钥交换问题，用随机数产生对称算法使用的"会话密钥"，再用公钥加密，对方拿到密文后用私钥解密，取出会话密钥，完成对称密钥的安全交换，后续全使用对称加密。

    (使用非对称算法对**对称算法的对称密钥进行加密**，然后再进行传输)

    ![image-20201010000242697](C:\Users\Admin\AppData\Roaming\Typora\typora-user-images\image-20201010000242697.png)

    

- ##### 完整性:摘要算法

  相当于特殊的压缩算法，**能把任意长度数据压缩成特定长度、独一无二的摘要**字符串

  存在冲突的可能性(不同的原文对应相同的摘要)，要求好的摘要算法能够抵抗冲突

  - [ ] 单向性：单向加密算法，只有算法，无密钥，不能通过摘要破解
  - [ ] 雪崩性:输入微小不同可能导致输出巨大变化(TLS可用来生成随机数)、

  TLS中使用的摘要算法是SHA-2:一系列摘要算法统称，有六种(SHA224\28,SHA256\32,SHA384\48)

  数字摘要与原文完全等价，在原文后加上摘要即可判断完整性

  但由于摘要算法不具有机密性，明文传输时，黑客可以一起改变摘要，所以完整性必须建立在机密性之上

- ##### 数字签名(确认身份):私钥+摘要算法(实现身份认证和不可否认)

  私钥只加密原文的摘要(运算量小)

  过程:

  签名和公钥一样是公开的，任何人都可以获取，但这个签名只有用私钥对应的公钥才能够解开，然后拿到摘要，对比原文验证完整性。(签名和验签)

- ##### 数字证书和CA

  公钥可能不可信，所以需要CA(证书认证机构)来给各个公钥签名(序列号，用途，颁发者，有效时间等信息打包签名)，形成数字证书。

  知名的 CA:DigiCert、VeriSign、Entrust、Let’s Encrypt

  签发的证书有DV(低),OV,EV(级别最高，经过法律和审计的严格审查)

  **小CA通过大CA签名认证身份，根CA(Root CA)只能自己证明自己，就叫自签名证书/根证书**

  各大浏览器和操作系统内置了各大CA的根证书，上网时服务器发过来证书，就可以验证证书的签名，顺着证书链一层层验证，知道找到根证书，就能证明证书可信，公钥可信。

  证书体系可能有不可信的情况，当CA失误或被欺骗时或被攻陷时。解决办法有:

  - [ ] CRL(证书吊销列表)，OCSP(在线证书协议):及时废止有问题的证书
  - [ ] 撤销对CA的信任，列入黑名单-----所有证书都会认为不安全

  





